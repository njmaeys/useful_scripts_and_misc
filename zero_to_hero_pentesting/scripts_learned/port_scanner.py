#!/root/code/git/useful_scripts_and_misc/zero_to_hero_pentesting/venv/bin/python

"""
Time to build a shitty port scanner
"""

import sys
import socket # how we are actually going to scan
from datetime import datetime

# define our target
if len(sys.argv) >= 2:
    target = socket.gethostbyname(sys.argv[1]) # translate host name to IPV4
else:
    print("IP not provided")
    print("Syntax: python port_scanner.py <ip>")
    sys.exit()

startTime = datetime.now()

print("-" * 50)
print("Going to scan: {target}".format(target=target))
print("Time started: {timeStart}".format(timeStart=str(startTime)))
print("-" * 50)

try:

    for port in range(50, 85):
        # AF_INET = IPV4, SOCK_STREAM = Port
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        # set a default timeout otherwise it will hang forever if there is nothing open
        socket.setdefaulttimeout(1) # this is a float can use 0.5 as an example

        result = s.connect_ex((target, port)) # return error indicator if no error we get 0

        print("Checking port :{port}".format(port=port))
        if result == 0:
            print("\tPort is open: {port}".format(port=port))

        s.close()

except KeyboardInterrupt:

    print("\nExiting program with keyboard interrupt.")
    sys.exit()

except socket.gaierror:

    print("\nCannot resolve host name.")
    sys.exit()

except socket.error:

    print("\nCannot connect to server.")
    sys.exit()
